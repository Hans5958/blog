---
import type { CollectionEntry } from 'astro:content';
import { unified } from 'unified';
import remarkParse from 'remark-parse'
import remarkGfm from 'remark-gfm'
import remarkHtml from 'remark-html'
import relativeUrl from './urlHelper.js';
import { Icon } from 'astro-icon';
import readingTime from 'reading-time';
import { Image } from "astro:assets";

interface Props {
  post: CollectionEntry<'posts'>;
}

// `post` will match your 'blog' collection schema type
const { post } = Astro.props;
const { Content, headings } = await post.render();

const coverImageAstro = post.data.cover?.src || ""

let excerpt = ""

if (post.data.excerpt) {
	const excerptUnified = await unified()
		.use(remarkParse)
		.use(remarkGfm)
		.use(remarkHtml)
		.process(post.data.excerpt)
	excerpt = excerptUnified.toString()
}

const readingTimeMins = Math.round(readingTime(post.body).minutes)
let readingTimeDisplay: string
if (readingTimeMins === 1) readingTimeDisplay = "1 minute"
else readingTimeDisplay = readingTimeMins + " minutes"
---

<a href={relativeUrl('/' + post.slug)} class="block p-4 rounded border border-gray-300 hover:bg-gray-100 focus:bg-gray-100 active:bg-gray-200 focus:ring focus:ring-blue-500 focus:outline-none active:outline-none">

	<article itemscope itemtype="http://schema.org/BlogPosting">

		<header class="post-header">
			<h1 class="text-3xl font-bold mb-2" itemprop="name headline">{ post.data.title }</h1>
			<p class="text-gray-500">
				<Icon name="bi:calendar-fill" class="w-4 h-4 inline align-[-.125rem]" />
				<time class="post-date-published" datetime={ post.data.date.toISOString() } itemprop="datePublished">
					{ post.data.date.toLocaleDateString('en-UK', { year: 'numeric', month: 'long', day: 'numeric' }) }
				</time>
				â€“
				<Icon name="bi:clock-fill" class="w-4 h-4 inline align-[-.125rem]" />
				<span>{ readingTimeDisplay }</span>	
			</p>
		</header>

		{ post.data.cover && <Image itemprop="image" class="mt-4" src={ post.data.cover } alt={ post.data.coverAlt } /> }
		{ excerpt && <div class="mt-3" itemprop="articleBody" set:html={ excerpt }></div> }
		
	</article>

</a>
