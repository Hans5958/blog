---
import type { CollectionEntry } from 'astro:content';
import TableOfContents from '../components/TableOfContents.astro';
import Default from './Default.astro';
import Giscus from '@giscus/vue'
import baseUrl from '../components/baseUrl.js';
import { Icon } from 'astro-icon';
import readingTime from 'reading-time';

interface Props {
  post: CollectionEntry<'posts'>;
}

// `post` will match your 'blog' collection schema type
const { post } = Astro.props;
const { Content, headings } = await post.render();

const coverImageAstro = post.data.cover?.src || ""

const readingTimeMins = Math.round(readingTime(post.body).minutes)
let readingTimeDisplay: string
if (readingTimeMins === 1) readingTimeDisplay = "1 minute"
else readingTimeDisplay = readingTimeMins + " minutes"
---

<Default title={post.data.title} description={post.data.description}>
	
	<article class="container mx-auto md:max-w-[768px] py-6" itemscope itemtype="http://schema.org/BlogPosting">

		<header class="post-header mb-4">
			<h1 class="text-4xl font-bold mb-2" itemprop="name headline">{ post.data.title }</h1>
			<p class="text-gray-500">
				<Icon name="bi:calendar-fill" class="w-4 h-4 inline align-[-.125rem]" />
				<time class="post-date-published" datetime={ post.data.date.toISOString() } itemprop="datePublished">
					{ post.data.date.toLocaleDateString('en-UK', { year: 'numeric', month: 'long', day: 'numeric' }) }
				</time>
				â€“
				<Icon name="bi:clock-fill" class="w-4 h-4 inline align-[-.125rem]" />
				<span>{ readingTimeDisplay }</span>
				
			</p>
		</header>

		{ post.data.cover && (<>
			<img itemprop="image" class="mb-3" src={ baseUrl(coverImageAstro.toString()) } alt="{ post.data.cover.alt }" />
		</>) }

		<div class="border mb-3 p-4 text-gray-500">
			<h3 class="mb-2 pb-2 border-b">Contents</h3>
			<div class="-ml-6">
				<TableOfContents headings={ headings } />
			</div>
		</div>
		
		<div class="post-body" itemprop="articleBody">
			<Content />
		</div>

		<hr class="my-4" />

		<div class="text-gray-500 mb-4">
			<p>Tags: { post.data.tags.length === 0 ? <span class="italic">none</span> : <>
				{ post.data.tags.map((tag, i) => <>
					<a class="hover:underline focus:underline active:underline active:text-gray-700" href={ baseUrl(`/tag/${tag}`) }>{ tag }</a>
					{ i !== post.data.tags.length - 1 && ', ' }
				</>) } 
			</> }</p>
			<p>Categories: <a class="hover:underline focus:underline active:underline active:text-gray-700" href={ baseUrl(`/category/${post.data.category.toLowerCase()}`) }>{ post.data.category }</a></p>			
		</div>
		
		<Giscus
			id="comments"
			repo="ScratchAddons/website-v2"
			repoId="MDEwOlJlcG9zaXRvcnkzNjU3NzE1MTQ="
			category="Page comments"
			categoryId="DIC_kwDOFc06-s4COGAf"
			mapping="pathname"
			strict="1"
			reactionsEnabled="1"
			emitMetadata="0"
			inputPosition="top"
			theme="light"
			lang="en"
			loading="lazy"
		/>	
	</article>
</Default>