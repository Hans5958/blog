---
import { CollectionEntry, getCollection } from 'astro:content'
import Archive from '../../../layouts/Archive.astro'

export async function getStaticPaths() {
	const blogEntries = await getCollection('posts')
	blogEntries.sort((a, b) => a.data.date.getTime() - b.data.date.getTime())
	
	const dates: { [index: number]: CollectionEntry<'posts'>[] } = {}
	
	blogEntries.forEach(post => {
		const postDate = `${post.data.date.getFullYear()}-${(post.data.date.getMonth() + 1).toString().padStart(2, '0')}`
		if (!dates[postDate]) {
			dates[postDate] = []
		}
		dates[postDate].push(post)
	})

	return Object.entries(dates).map(([date, pages]) => {
		const [year, month] = date.split('-')
		return {
			params: { year, month, },
			props: { year, month, data: pages }
		}
	})
}

const { data, year, month } = Astro.props;
const title = `Month: ${year}-${month}`
---

<Archive data={data} title={title} />
