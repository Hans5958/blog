---
import { Icon } from "astro-icon/components"
import { CollectionEntry, getCollection } from 'astro:content'
import relativeUrl from '../../components/urlHelper.js'
import ArchiveIndex from '../../layouts/ArchiveIndex.astro'

const blogEntries = await getCollection('posts')

const categories: { [index: string]: CollectionEntry<'posts'>[] } = {}
	
blogEntries.forEach(post => {
	const category = post.data.category 
	if (!categories[category]) {
		categories[category] = []
	}
	categories[category].push(post)
})
---

<ArchiveIndex title="Category">
	<div class="flex flex-wrap">
		{ Object.keys(categories).map(category => (<>
			<a href={ relativeUrl('/category/' + category.toLowerCase()) } class="flex flex-row px-4 py-2 rounded border border-gray-300 hover:bg-gray-100 focus:bg-gray-100 active:bg-gray-200 focus:ring focus:ring-blue-500 focus:outline-none active:outline-none mr-2 mb-2" >
				<Icon name="octicon:file-directory-16" class="w-6 h-6 mr-2"></Icon>
				<div class="-mt-[.1rem] align-middle text-lg font-semibold mr-2">{ category }</div>
				<div class="mt-[.2rem] text-sm text-gray-500">{ categories[category].length } posts</div>
			</a>
		</>)) }	
	</div>
</ArchiveIndex>
