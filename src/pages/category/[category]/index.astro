---
import { CollectionEntry, getCollection } from 'astro:content'
import Archive from '../../../layouts/Archive.astro'

export async function getStaticPaths() {
	const blogEntries = await getCollection('posts')
	blogEntries.sort((a, b) => b.data.date.getTime() - a.data.date.getTime())

	const categories: { [index: string]: CollectionEntry<'posts'>[] } = {}
	
	blogEntries.forEach(post => {
		const category = post.data.category
		if (!categories[category]) {
			categories[category] = []
		}
		categories[category].push(post)
	})

	return Object.entries(categories).map(([category, pages]) => ({
		params: { category: category.toLowerCase() },
		props: { category: category, data: pages }
	}))
}

const { data, category } = Astro.props;
const title = `Category: ${category}`
---

<Archive data={data} title={title} />
